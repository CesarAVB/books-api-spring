# ================================
# Nome do workflow
# ================================
# Esse nome aparece na aba "Actions" do GitHub
name: CI Pipeline


# ================================
# Eventos que disparam o workflow
# ================================
on:
  # Executa quando alguém fizer push
  push:
    # Apenas nessas branches
    branches: [ main, develop ]

  # Executa quando um Pull Request for aberto ou atualizado
  pull_request:
    # Apenas PRs que tenham como destino a branch main
    branches: [ main ]


# ================================
# Jobs = grupos de tarefas
# ================================
jobs:

  # Nome interno do job (pode ser qualquer nome)
  test:

    # Sistema operacional do runner
    # ubuntu-latest é o mais comum e gratuito
    runs-on: ubuntu-latest

    # Nome amigável que aparece no GitHub Actions
    name: Build and Test


    # ================================
    # Steps = passos executados em ordem
    # ================================
    steps:

      # ----------------------------
      # Step 1: Checkout do código
      # ----------------------------
      # Baixa o código do repositório para o runner
      # Sem isso, o runner não tem acesso ao projeto
      - name: Checkout code
        uses: actions/checkout@v4


      # ----------------------------
      # Step 2: Configura o Java
      # ----------------------------
      # Instala o JDK no runner
      # Aqui você escolhe a versão do Java do projeto
      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          # Versão do Java
          java-version: '21'

          # Distribuição OpenJDK (Temurin é padrão de mercado)
          distribution: 'temurin'

          # Ativa cache automático do Maven
          # Evita baixar dependências toda vez
          cache: 'maven'


      # ----------------------------
      # Step 3: Executa build e testes
      # ----------------------------
      - name: Run tests
        run: |
          # Dá permissão de execução ao mvnw
          # Necessário porque o runner Linux respeita permissões
          chmod +x mvnw

          # Executa o Maven Wrapper
          # clean -> limpa builds anteriores
          # test  -> compila e roda os testes
          ./mvnw clean test
